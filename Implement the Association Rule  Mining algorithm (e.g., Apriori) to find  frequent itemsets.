import pandas as pd
from mlxtend.frequent_patterns import apriori,association_rules
from mlxtend.preprocessing import TransactionEncoder
import matplotlib.pyplot as plt
import seaborn as sns
import networkx as nx
#run

data=pd.read_csv("Groceries_dataset.csv")
print("First 5 rows of dataset:")
print(data.head())
#run

transactions = data .groupby("Member_number")["itemDescription"].apply(list).tolist()
te = TransactionEncoder()
te_array = te.fit(transactions).transform(transactions)
df=pd.DataFrame(te_array,columns=te.columns_)
print("\nShape of transaction matrix:",df.shape)
#run

print(data.columns)
#run

frequent_itemsets = apriori(df,min_support=0.01,use_colnames=True)
frequent_itemsets=frequent_itemsets.sort_values(by="support",ascending=False)

print("\nTop 10 Frequent Itemsets: ")
print(frequent_itemsets.head(10))
#run

rules = association_rules(frequent_itemsets,metric="lift",min_threshold=1.0)
rules = rules.sort_values(by="lift",ascending=False)

print("\nTop 10 Association Rules:")
print(rules[['antecedents','consequents','support','confidence','lift']].head(10))
#run

item_counts=data["itemDescription"].value_counts().head(20)
plt.figure(figsize=(10,6))
sns.barplot(x=item_counts.values,y=item_counts.index,palette="viridis")
plt.title("Top 20 Most Frequent Items")
plt.xlabel("Count")
plt.ylabel("item")
plt.show()
#run
